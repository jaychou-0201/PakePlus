(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-48b3e5d2"],{"137e":function(t,e,a){"use strict";a("d8b6")},"4e3c":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("div",[e("el-row",[e("el-col",{attrs:{span:24}},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",{staticStyle:{"line-height":"36px","font-weight":"bold","font-size":"large"}},[t._v("快捷菜单")]),e("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"设置快捷菜单",placement:"top-start"}},[e("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.handleRole}})],1)],1),e("div",{staticClass:"text item"},[e("div",{staticClass:"wel"},[e("el-carousel",{staticStyle:{width:"100%",height:"120px"},attrs:{"indicator-position":"none",interval:0,arrow:"always"}},t._l(t.menuPage,(function(a){return e("el-carousel-item",{key:a},[e("avue-data-icons",{staticStyle:{width:"100%"},attrs:{option:t.menuOption[a-1]}})],1)})),1)],1)])])],1)],1),e("el-dialog",{attrs:{title:"快捷菜单配置","append-to-body":"",visible:t.box,width:"20%"},on:{"update:visible":function(e){t.box=e}}},[e("el-tabs",{attrs:{type:"border-card"}},[e("el-tree",{ref:"treeMenu",staticStyle:{height:"300px","overflow-y":"auto"},attrs:{data:t.menuGrantList,"show-checkbox":"","node-key":"id","default-checked-keys":t.menuTreeObj,"check-strictly":"",props:t.props}})],1),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.box=!1}}},[t._v("取 消")]),e("el-button",{attrs:{type:"primary"},on:{click:t.submit}},[t._v("确 定")])],1)],1),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",{staticStyle:{"line-height":"36px","font-weight":"bold","font-size":"large"}},[t._v("当天任务进度")]),e("span",{staticStyle:{"line-height":"12px","font-size":"12px",color:"#d56259"}},[t._v("\n            (间隔10s自动更新)")])]),e("avue-data-icons",{attrs:{option:t.todayTaskOption}}),e("avue-data-progress",{attrs:{option:t.todayTaskProgressOption}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",{staticStyle:{"line-height":"36px","font-weight":"bold","font-size":"large"}},[t._v("待产任务")]),e("span",{staticStyle:{"line-height":"12px","font-size":"12px",color:"#d56259"}},[t._v("\n            (间隔30s自动更新)")]),e("el-button",{staticStyle:{float:"right"},attrs:{type:"success",icon:"el-icon-refresh",circle:""},on:{click:function(e){return t.getNotFinishTaskData(!1)}}})],1),e("avue-crud",{attrs:{option:t.taskOption,data:t.taskData,"table-loading":t.loadingTask},on:{"on-load":function(e){return t.getNotFinishTaskData(!1)}}})],1)],1)],1),e("WorkStationSelect",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"workStationSelect",on:{onSelected:t.returnStation}}),e("el-row",{attrs:{gutter:20}},[e("el-col",{attrs:{span:12}},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",{staticStyle:{"line-height":"36px","font-weight":"bold","font-size":"large"}},[t._v("超期库存")]),e("span",{staticStyle:{"line-height":"12px","font-size":"12px",color:"#d56259"}},[t._v("\n            (间隔30s自动更新)")]),e("el-button",{staticStyle:{float:"right"},attrs:{type:"success",icon:"el-icon-refresh",circle:""},on:{click:function(e){return t.getInventoryExtendedData(!1)}}})],1),e("avue-crud",{attrs:{option:t.inventoryExtendedOption,data:t.inventoryExtendedData,"table-loading":t.loading},on:{"on-load":function(e){return t.getInventoryExtendedData(!1)}}})],1)],1),e("el-col",{attrs:{span:12}},[e("el-card",{staticClass:"box-card"},[e("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[e("span",{staticStyle:{"line-height":"36px","font-weight":"bold","font-size":"large"}},[t._v("库存预警")]),e("span",{staticStyle:{"line-height":"12px","font-size":"12px",color:"#d56259"}},[t._v("\n            (间隔30s自动更新)")]),e("el-button",{staticStyle:{float:"right"},attrs:{type:"success",icon:"el-icon-refresh",circle:""},on:{click:function(e){return t.getMaterialAlarmData(!1)}}})],1),e("avue-crud",{attrs:{option:t.materialAlarmOption,data:t.materialAlarmList,"table-loading":t.loadingMaterial},on:{"on-load":function(e){return t.getMaterialAlarmData(!1)}},scopedSlots:t._u([{key:"status",fn:function(a){return[0==a.row.status?e("el-tag",[t._v("超出最高库存")]):t._e(),1==a.row.status?e("el-tag",{attrs:{type:"danger"}},[t._v("低于最低库存")]):t._e()]}}])})],1)],1)],1)],1)},o=[],i=(a("7f7f"),a("ac6a"),a("3528")),r=a("e8df"),s=a("0ac4"),l=a("1d50"),c=a("a707"),d=a("e3c4"),u=a("323e"),h=a.n(u),p={components:{WorkStationSelect:c["default"]},data:function(){return{defaultWorkstationId:null,defaultWorkstationName:"未设置默认工作站",menuPage:1,menuTreeObj:[],menuGrantList:[],loading:!1,loadingMaterial:!1,loadingTask:!1,box:!1,boxWorkstation:!1,props:{label:"title",value:"key"},menuOption:[{span:3,data:[]}],todayTaskOption:{decimals:0,span:6,data:[{title:"密炼计划锅次",count:0,color:"rgb(27, 201, 142)",icon:"iconfont iconicon_compile"},{title:"密炼完成锅次",count:0,color:"rgb(178, 159, 255)",icon:"iconfont iconicon_task_done"},{title:"小料计划框数",count:0,color:"rgb(178, 159, 255)",icon:"iconfont iconicon_compile"},{title:"小料完成框数",count:0,color:"rgb(178, 159, 255)",icon:"iconfont iconicon_task_done"}]},todayTaskProgressOption:{span:12,data:[{title:"密炼完成比例",color:"rgb(178, 159, 255)",count:0},{title:"小料完成比例",color:"rgb(230, 71, 88)",count:0}]},taskData:[],taskOption:{height:"250px",calcHeight:30,tip:!1,index:!1,viewBtn:!1,addBtn:!1,refreshBtn:!1,columnBtn:!1,selection:!1,header:!1,menu:!1,align:"center",column:[{label:"任务编号",prop:"taskCode",overHidden:!0},{label:"物料名称",prop:"materialName",overHidden:!0},{label:"物料编码",prop:"materialCode",overHidden:!0},{label:"计划锅次",prop:"batchNum",type:"number",width:80},{label:"完成锅次",prop:"completeNum",type:"number",width:80},{label:"任务状态",prop:"taskStatus",dataType:"string",dicUrl:"/api/blade-system/dict-biz/dictionary?code=task_status",props:{label:"dictValue",value:"dictKey"},width:80},{label:"备注",prop:"remarks",type:"textarea",showWordLimit:!0,overHidden:!0,width:100}]},materialAlarmOption:{height:"360px",calcHeight:30,tip:!1,index:!1,viewBtn:!1,addBtn:!1,refreshBtn:!1,columnBtn:!1,selection:!1,header:!1,menu:!1,align:"center",column:[{label:"物料编码",prop:"materialCode",overHidden:!0,filters:!0,filterMethod:function(t,e,a){return e.materialCode===t}},{label:"物料名称",prop:"materialName",overHidden:!0,filters:!0,filterMethod:function(t,e,a){return e.materialName===t}},{label:"单位",prop:"unitName"},{label:"当前库存",prop:"stockNum",type:"number"},{label:"最低库存",prop:"minStock",type:"number"},{label:"最高库存",prop:"maxStock",type:"number"},{label:"状态",prop:"status",width:120,filters:!0,type:"select",dicData:[{label:"超出最高库存",value:0},{label:"低于最低库存",value:1}],html:!0,formatter:function(t){return 0==t.status?"<el-tag>超出最高库存</el-tag>":'<el-tag type="danger">低于最低库存</el-tag>'},filterMethod:function(t,e,a){return e.status===t}}]},materialAlarmList:[],inventoryExtendedData:[],inventoryExtendedOption:{height:"360px",calcHeight:30,tip:!1,index:!1,viewBtn:!1,addBtn:!1,refreshBtn:!1,columnBtn:!1,selection:!1,header:!1,menu:!1,align:"center",column:[{label:"物料编码",prop:"materialCode",overHidden:!0,filters:!0,filterMethod:function(t,e,a){return e.materialCode===t}},{label:"物料名称",prop:"materialName",overHidden:!0,filters:!0,filterMethod:function(t,e,a){return e.materialName===t}},{label:"批次条码",prop:"batchCode"},{label:"入库数量",prop:"receiptNum"},{label:"剩余数量",prop:"residueNum"},{label:"超期天数",prop:"dayNum"},{label:"生产日期",prop:"productionDate",dataType:"date"},{label:"入库时间",prop:"createTime",dataType:"datetime"}]}}},computed:{ids:function(){var t=[];return this.selectionList.forEach((function(e){t.push(e.id)})),t.join(",")}},created:function(){h.a.configure({template:'<div role="bar"><div></div></div>'}),this.initMenu(),this.getTaskData();var t=this,e=setInterval((function(){t.getTaskData()}),1e4),a=setInterval((function(){t.getNotFinishTaskData(!0),t.getInventoryExtendedData(!0),t.getMaterialAlarmData(!0)}),3e4);this.$once("hook:beforeDestroy",(function(){clearInterval(e),clearInterval(a),h.a.configure({template:'<div class="bar" role="bar"><div class="peg"></div></div>'})}))},methods:{initMenu:function(){var t=this;Object(i["getUserMenu"])().then((function(e){for(var a=[],n=0,o=0,i=Math.ceil(e.data.data.length/8),r=e.data.data.length,s=0;s<i;s++)a.push({span:3,data:[]});t.menuPage=i,e.data.data.forEach((function(e){(8==n||n==r%8!=0&&(r%8-1&&o==i-1)||n==r-1)&&(n=0,o<i-1&&o++);var s={title:e.name,icon:e.source,href:"#",that:t,path:e.path,click:function(t){t.that.$router.push({path:t.path})}};a[o].data.push(s),n++})),t.menuOption=a}))},handleRole:function(){var t=this;this.menuTreeObj=[],Object(i["grantMenuTree"])().then((function(e){t.menuGrantList=e.data.data.menu,t.menuGrantList.forEach((function(t){t.disabled=!0})),Object(i["getUserMenuIds"])().then((function(e){t.box=!0,t.menuTreeObj=e.data.data.menu}))}))},submit:function(){var t=this,e=this.$refs.treeMenu.getCheckedKeys();Object(i["userMenuSave"])(e).then((function(){t.box=!1,t.$message({type:"success",message:"操作成功!"}),t.initMenu()}))},getInventoryExtendedData:function(t){var e=this;t||(this.loading=!0),Object(r["getExtendedInventory"])().then((function(t){var a=t.data.data;e.inventoryExtendedData=a,e.loading=!1}))},getMaterialAlarmData:function(t){var e=this;t||(this.loadingMaterial=!0),Object(r["getInventorySafety"])().then((function(t){var a=t.data.data;e.materialAlarmList=a,e.loadingMaterial=!1}))},getTaskData:function(){var t=this;Object(s["queryTodayTask"])().then((function(e){var a=e.data.data,n=0,o=0;a.forEach((function(t){n+=t.batchNum,o+=t.completeNum})),t.todayTaskOption.data[0].count=n,t.todayTaskOption.data[1].count=o,t.todayTaskProgressOption.data[0].count=o/n*100})),Object(l["queryTodayTask"])().then((function(e){var a=e.data.data,n=0,o=0;a.forEach((function(t){n+=t.batchNum,o+=t.completeNum})),t.todayTaskOption.data[2].count=n,t.todayTaskOption.data[3].count=o,t.todayTaskProgressOption.data[1].count=o/n*100}))},getNotFinishTaskData:function(t){var e=this;t||(this.loadingTask=!0),Object(s["queryNotFinishTask"])().then((function(t){var a=t.data.data;e.taskData=a,e.loadingTask=!1}))},changeWorkStation:function(){this.$refs.workStationSelect.showFlag=!0},returnStation:function(t){this.defaultWorkstationName=t.workstationName,this.defaultWorkstationId=t.id,this.$refs.workStationSelect.showFlag=!1,Object(d["e"])({name:"default-workstation",content:t}),this.$message({type:"success",message:"设置默认工作站为：".concat(t.workstationName)}),this.getTaskData(),this.getNotFinishTaskData(!1)}}},g=p,f=(a("137e"),a("2877")),m=Object(f["a"])(g,n,o,!1,null,"044e06b9",null);e["default"]=m.exports},a707:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t._self._c;return e("basic-container",[t.showFlag?e("el-dialog",{attrs:{title:"选择工作站",visible:t.showFlag,modal:!1,top:"2%","append-to-body":"",width:"70%",center:""},on:{"update:visible":function(e){t.showFlag=e}}},[e("avue-crud",{ref:"crud",attrs:{option:t.option,"table-loading":t.loading,data:t.data,page:t.page,"before-open":t.beforeOpen},on:{"update:page":function(e){t.page=e},"row-update":t.rowUpdate,"row-save":t.rowSave,"row-del":t.rowDel,"row-dblclick":t.handleRowDbClick,"search-change":t.searchChange,"search-reset":t.searchReset,"selection-change":t.selectionChange,"current-change":t.currentChange,"size-change":t.sizeChange,"refresh-change":t.refreshChange,"on-load":t.onLoad}}),e("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{attrs:{type:"primary"},on:{click:t.confirmSelect}},[t._v("确 定")]),e("el-button",{on:{click:function(e){t.showFlag=!1}}},[t._v("取 消")])],1)],1):t._e()],1)},o=[],i=(a("6762"),a("2fdb"),a("9966")),r=a("8ddc"),s=a("1e9f"),l=a("d8f9"),c=a("658b"),d={data:function(){return{form:{},batchForm:{materialSub:[{materialId:"",materialName:"",materialCode:"",materialType:"",setVal:"",tolerance:"",batchCode:""}],points:""},showFlag:!1,batchNum:0,batchFormKey:0,taskId:0,materialBatchList:[],materialList:[],materialTypeList:[],unitTypeList:[],materialBatchBox:!1,materialStockBox:!1,query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},selectionList:[],orderList:[],option:{height:"400px",calcHeight:30,tip:!1,searchShow:!0,searchMenuSpan:6,border:!0,index:!0,viewBtn:!0,menu:!1,selection:!1,addBtn:!1,dialogClickModal:!0,labelWidth:"130",menuWidth:300,column:[{label:"工作站编码",prop:"workstationCode",rules:[{required:!0,message:"请输入工作站编码",trigger:"blur"}]},{label:"工作站名称",prop:"workstationName",search:!0,searchLabelWidth:90,rules:[{required:!0,message:"请输入工作站名称",trigger:"blur"}]},{label:"工作站地点",prop:"workstationAddress",rules:[{required:!0,message:"请输入工作站地点",trigger:"blur"}]},{label:"所在车间",prop:"workshopName",type:"select",search:!0,dicData:[],props:{label:"name",value:"code"},rules:[{required:!0,message:"请输入所在车间",trigger:"change"}]},{label:"所属工序",prop:"processName",type:"select",dicData:[],props:{label:"name",value:"code"},rules:[{required:!0,message:"请输入工序名称",trigger:"change"}]},{label:"是否启用",prop:"status",type:"select",dataType:"string",search:!0,value:"1",dicData:[],props:{label:"dictValue",value:"dictKey"},rules:[{required:!0,message:"请选择是否可用",trigger:"change"}]},{label:"备注",prop:"remark",maxlength:64},{labelWidth:0,label:"",prop:"info",span:24,hide:!0,formslot:!0},{label:"所属设备",prop:"deviceList",type:"dynamic",hide:!0,span:24,children:{maxHeight:"300",align:"center",headerAlign:"center",rowAdd:function(t){t()},rowDel:function(t,e){e()},column:[{label:"设备组",prop:"machineryId",type:"select",remote:!0,props:{label:"groupName",value:"id"},dicUrl:"/api/mes/equip/eqgroup/getOptions?name={{key}}",rules:[{required:!0,message:"请选择设备组",trigger:"change"}]}]}}]},data:[]}},mounted:function(){var t=this;Object(r["getDictionary"])({code:"yes_no"}).then((function(e){var a=t.findObject(t.option.column,"status");a.dicData=e.data.data})),Object(s["listProcess"])().then((function(e){var a=t.findObject(t.option.column,"processName");a.dicData=e.data.data})),Object(l["listWorkShop"])().then((function(e){var a=t.findObject(t.option.column,"workshopName");a.dicData=e.data.data}))},methods:{rowSave:function(t,e,a){var n=this;Object(i["add"])(t).then((function(){n.onLoad(n.page),n.$message({type:"success",message:"操作成功!"}),e()}),(function(t){a(),window.console.log(t)}))},rowUpdate:function(t,e,a,n){var o=this;Object(i["update"])(t).then((function(){o.onLoad(o.page),o.$message({type:"success",message:"操作成功!"}),a()}),(function(t){n(),console.log(t)}))},rowDel:function(t){var e=this;this.$confirm("确定将选择数据删除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(i["remove"])(t.id)})).then((function(){e.onLoad(e.page),e.$message({type:"success",message:"操作成功!"})}))},handleDelete:function(){var t=this;0!==this.selectionList.length?this.$confirm("确定将选择数据删除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(i["remove"])(t.ids)})).then((function(){t.onLoad(t.page),t.$message({type:"success",message:"操作成功!"}),t.$refs.crud.toggleSelection()})):this.$message.warning("请选择至少一条数据")},beforeOpen:function(t,e){var a=this;["edit","view"].includes(e)&&Object(i["getDetail"])(this.form.id).then((function(t){a.form=t.data.data})),t()},searchReset:function(){this.query={},this.onLoad(this.page)},searchChange:function(t,e){this.query=t,this.page.currentPage=1,this.onLoad(this.page,t),e()},selectionChange:function(t){this.selectionList=t},selectionClear:function(){this.selectionList=[],this.$refs.crud.toggleSelection()},currentChange:function(t){this.page.currentPage=t},sizeChange:function(t){this.page.pageSize=t},refreshChange:function(){this.onLoad(this.page,this.query)},onLoad:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,Object(i["getList"])(t.currentPage,t.pageSize,Object.assign(a,this.query)).then((function(t){var a=t.data.data;e.page.total=a.total,e.data=a.records,e.loading=!1,e.selectionClear()}))},rowWorkerSave:function(t,e,a){var n=this;t.workstationId=this.form.id,Object(c["add"])(t).then((function(){n.onWorkerLoad(n.pagesub),n.$message({type:"success",message:"操作成功!"}),e()}),(function(t){a(),window.console.log(t)}))},rowWorkerUpdate:function(t,e,a,n){var o=this;Object(c["update"])(t).then((function(){o.onWorkerLoad(o.pagesub),o.$message({type:"success",message:"操作成功!"}),a()}),(function(t){n(),console.log(t)}))},rowWorkerDel:function(t){var e=this;this.$confirm("确定将选择数据删除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(c["remove"])(t.id)})).then((function(){e.onWorkerLoad(e.pagesub),e.$message({type:"success",message:"操作成功!"})}))},handleWorkerDelete:function(){var t=this;0!==this.selectionListsub.length?this.$confirm("确定将选择数据删除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(c["remove"])(t.ids)})).then((function(){t.onWorkerLoad(t.page),t.$message({type:"success",message:"操作成功!"}),t.$refs.crudsub.toggleSelection()})):this.$message.warning("请选择至少一条数据")},beforeWorkerOpen:function(t,e){var a=this;["edit","view"].includes(e)&&Object(c["getDetail"])(this.formsub.id).then((function(t){a.formsub=t.data.data})),t()},searchWorkerReset:function(){this.querysub={},this.onWorkerLoad(this.pagesub)},searchWorkerChange:function(t,e){this.querysub=t,this.pagesub.currentPage=1,this.onWorkerLoad(this.pagesub,t),e()},selectionWorkerChange:function(t){this.selectionListsub=t},selectionWorkerClear:function(){this.selectionListsub=[],this.$refs.crud.toggleSelection()},currentWorkerChange:function(t){this.pagesub.currentPage=t},sizeWorkerChange:function(t){this.pagesub.pageSize=t},refreshWorkerChange:function(){this.onWorkerLoad(this.page,this.query)},onWorkerLoad:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loadingsub=!0,Object(c["getList"])(t.currentPage,t.pageSize,Object.assign(a,this.querysub)).then((function(t){var a=t.data.data;e.pagesub.total=a.total,e.datasub=a.records,e.loadingsub=!1,e.selectionWorkerClear()}))},handleRowChange:function(t){t&&(this.selectedRow=t)},confirmSelect:function(){null!=this.selectedTaskId&&0!=this.selectedTaskId?(this.$emit("onSelected",this.selectedRow),this.showFlag=!1):this.$notify({title:"提示",type:"warning",message:"请至少选择一条数据!"})},handleRowDbClick:function(t){t&&(this.selectedRow=t,this.$emit("onSelected",this.selectedRow),this.showFlag=!1)}}},u=d,h=a("2877"),p=Object(h["a"])(u,n,o,!1,null,null,null);e["default"]=p.exports},d8b6:function(t,e,a){}}]);